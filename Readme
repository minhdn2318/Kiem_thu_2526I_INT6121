# Há»† THá»NG KIá»‚M THá»¬ KHá»šP Lá»†NH CHá»¨NG KHOÃN (STOCK MATCHING SYSTEM)

---

## ğŸ§¾ 1. PHÃT BIá»‚U BÃ€I TOÃN

Há»‡ thá»‘ng mÃ´ phá»ng quÃ¡ trÃ¬nh **khá»›p lá»‡nh chá»©ng khoÃ¡n** trÃªn sÃ n giao dá»‹ch.  
CÃ¡c nhÃ  Ä‘áº§u tÆ° cÃ³ thá»ƒ **Ä‘áº·t lá»‡nh mua hoáº·c bÃ¡n cá»• phiáº¿u**, vÃ  há»‡ thá»‘ng sáº½ **tá»± Ä‘á»™ng khá»›p lá»‡nh** dá»±a trÃªn **giÃ¡ vÃ  thá»i gian**.

### CÃ¡c thÃ nh pháº§n chÃ­nh

| ThÃ nh pháº§n | MÃ´ táº£ |
|-------------|-------|
| **Investor (NhÃ  Ä‘áº§u tÆ°)** | CÃ³ thá»ƒ Ä‘áº·t lá»‡nh mua hoáº·c bÃ¡n cá»• phiáº¿u. |
| **Order (Lá»‡nh giao dá»‹ch)** | Chá»©a thÃ´ng tin: loáº¡i lá»‡nh (mua/bÃ¡n), mÃ£ cá»• phiáº¿u, giÃ¡, khá»‘i lÆ°á»£ng. |
| **OrderBook (Sá»• lá»‡nh)** | LÆ°u cÃ¡c lá»‡nh chá» khá»›p (mua/bÃ¡n). |
| **MatchingEngine (Bá»™ khá»›p lá»‡nh)** | Tá»± Ä‘á»™ng tÃ¬m cáº·p lá»‡nh mua-bÃ¡n cÃ³ thá»ƒ khá»›p. |
| **Trade (Giao dá»‹ch)** | Táº¡o ra sau khi khá»›p thÃ nh cÃ´ng. |
| **Account (TÃ i khoáº£n)** | Quáº£n lÃ½ tiá»n máº·t vÃ  cá»• phiáº¿u cá»§a nhÃ  Ä‘áº§u tÆ°. |

---

## 2. Äáº¶C Táº¢ CHá»¨C NÄ‚NG (USE CASE)

| MÃ£ Use Case | TÃªn Use Case | MÃ´ táº£ | Äáº§u vÃ o chÃ­nh | Äáº§u ra |
|--------------|---------------|--------|----------------|---------|
| **UC-01** | Äáº·t lá»‡nh mua | NhÃ  Ä‘áº§u tÆ° Ä‘áº·t lá»‡nh mua cá»• phiáº¿u | MÃ£ cá»• phiáº¿u, GiÃ¡, Khá»‘i lÆ°á»£ng | Lá»‡nh Ä‘Æ°á»£c lÆ°u trong sá»• lá»‡nh |
| **UC-02** | Äáº·t lá»‡nh bÃ¡n | NhÃ  Ä‘áº§u tÆ° Ä‘áº·t lá»‡nh bÃ¡n cá»• phiáº¿u | MÃ£ cá»• phiáº¿u, GiÃ¡, Khá»‘i lÆ°á»£ng | Lá»‡nh Ä‘Æ°á»£c lÆ°u trong sá»• lá»‡nh |
| **UC-03** | Khá»›p lá»‡nh | Há»‡ thá»‘ng khá»›p lá»‡nh tá»± Ä‘á»™ng theo quy táº¯c | CÃ¡c lá»‡nh mua & bÃ¡n | Giao dá»‹ch khá»›p thÃ nh cÃ´ng |
| **UC-04** | Xem sá»• lá»‡nh | NhÃ  Ä‘áº§u tÆ° xem danh sÃ¡ch cÃ¡c lá»‡nh chá» | TÃ i khoáº£n nhÃ  Ä‘áº§u tÆ° | Danh sÃ¡ch lá»‡nh |
| **UC-05** | Xem lá»‹ch sá»­ giao dá»‹ch | NhÃ  Ä‘áº§u tÆ° xem lá»‹ch sá»­ khá»›p lá»‡nh | TÃ i khoáº£n nhÃ  Ä‘áº§u tÆ° | Danh sÃ¡ch giao dá»‹ch Ä‘Ã£ khá»›p |

---

## 3. PHÃ‚N TÃCH TEST CASE (EP + BVA)

### Use Case: UC-01 â€“ Äáº·t lá»‡nh mua

**Äáº§u vÃ o:**  
- MÃ£ cá»• phiáº¿u: `VN30`, `FPT`, `VIC`, â€¦  
- GiÃ¡: `10,000 â€“ 100,000` VNÄ  
- Khá»‘i lÆ°á»£ng: `100 â€“ 1,000,000` cá»• phiáº¿u  

**PhÆ°Æ¡ng phÃ¡p:**
- **PhÃ¢n hoáº¡ch tÆ°Æ¡ng Ä‘Æ°Æ¡ng (EP):** chia giÃ¡ trá»‹ há»£p lá»‡ vÃ  khÃ´ng há»£p lá»‡.  
- **GiÃ¡ trá»‹ biÃªn (BVA):** kiá»ƒm thá»­ táº¡i ngÆ°á»¡ng giá»›i háº¡n.

| ID | Thuá»™c tÃ­nh | Loáº¡i kiá»ƒm thá»­ | Dá»¯ liá»‡u kiá»ƒm thá»­ | Káº¿t quáº£ mong Ä‘á»£i |
|----|-------------|----------------|------------------|------------------|
| TC01 | GiÃ¡ | Há»£p lá»‡ (EP) | 50,000 | Lá»‡nh há»£p lá»‡ |
| TC02 | GiÃ¡ | Tháº¥p hÆ¡n min (BVA) | 9,999 | Lá»‡nh bá»‹ tá»« chá»‘i |
| TC03 | GiÃ¡ | Táº¡i min (BVA) | 10,000 | Lá»‡nh há»£p lá»‡ |
| TC04 | GiÃ¡ | Táº¡i max (BVA) | 100,000 | Lá»‡nh há»£p lá»‡ |
| TC05 | GiÃ¡ | Lá»›n hÆ¡n max (BVA) | 100,001 | Lá»‡nh bá»‹ tá»« chá»‘i |
| TC06 | Khá»‘i lÆ°á»£ng | Há»£p lá»‡ (EP) | 500,000 | Lá»‡nh há»£p lá»‡ |
| TC07 | Khá»‘i lÆ°á»£ng | Nhá» hÆ¡n min (BVA) | 99 | Lá»‡nh bá»‹ tá»« chá»‘i |
| TC08 | Khá»‘i lÆ°á»£ng | Lá»›n hÆ¡n max (BVA) | 1,000,001 | Lá»‡nh bá»‹ tá»« chá»‘i |

---

## 4. Cáº¤U TRÃšC THÆ¯ Má»¤C Dá»° ÃN

```bash
ğŸ“ Kiem_thu_2526I_INT6121/
â”‚
â”œâ”€â”€ CFG.png                     # áº¢nh Control Flow Graph (CFG)
â”œâ”€â”€ Readme                      # File README
â”œâ”€â”€ auto_testgen_z3.py          # Sinh input testcase tá»± Ä‘á»™ng báº±ng Z3
â”œâ”€â”€ cfg_dot.py                  # Sinh file .dot tá»« code order.py
â”œâ”€â”€ dfs_from_dot.py             # TÃ¬m táº¥t cáº£ test path tá»« file .dot
â”œâ”€â”€ coverage_calc.py            # Lá»c test path theo 3 Ä‘á»™ Ä‘o (phá»§ lá»‡nh, nhÃ¡nh, Ä‘Æ°á»ng)
â”œâ”€â”€ coverage_runtime.py         # TÃ­nh testcase thá»±c cháº¡y chÆ°a Ä‘áº¡t 100% coverage
â”œâ”€â”€ order.py                    # Logic xá»­ lÃ½ lá»‡nh mua/bÃ¡n
â”œâ”€â”€ order_mini.dot              # File CFG dáº¡ng DOT
â”œâ”€â”€ requirements.txt            # ThÆ° viá»‡n Python cáº§n cÃ i
â”œâ”€â”€ test_buy_order.py           # Test EP + BVA cho lá»‡nh mua
â”œâ”€â”€ test_sell_order.py          # Test EP + BVA cho lá»‡nh bÃ¡n
â”œâ”€â”€ test_paths.txt              # Output cÃ¡c path tá»« DFS
â”œâ”€â”€ testcases_vn.csv            # Testcase sinh tá»± Ä‘á»™ng báº±ng Z3
â”œâ”€â”€ __pycache__/                # Cache Python
â””â”€â”€ 'SRS-kiem thu phan mem chung khoan.docx'  # TÃ i liá»‡u SRS gá»‘c
```

## 5. KIá»‚M THá»¬ Há»˜P ÄEN (BLACK-BOX TESTING)

Má»¥c tiÃªu: kiá»ƒm thá»­ dá»±a trÃªn **Ä‘áº§u vÃ o vÃ  Ä‘áº§u ra** mÃ  khÃ´ng quan tÃ¢m tá»›i logic bÃªn trong hÃ m.

### 5.1 PhÆ°Æ¡ng phÃ¡p

- **PhÃ¢n hoáº¡ch tÆ°Æ¡ng Ä‘Æ°Æ¡ng (EP â€“ Equivalence Partitioning):** chia dá»¯ liá»‡u Ä‘áº§u vÃ o thÃ nh cÃ¡c lá»›p há»£p lá»‡ vÃ  khÃ´ng há»£p lá»‡.
- **GiÃ¡ trá»‹ biÃªn (BVA â€“ Boundary Value Analysis):** kiá»ƒm thá»­ táº¡i cÃ¡c giÃ¡ trá»‹ biÃªn cá»§a cÃ¡c tham sá»‘.

### 5.2 VÃ­ dá»¥ testcase cho hÃ m `place_sell_order`

```python
import pytest
from order import place_sell_order

@pytest.mark.parametrize("symbol, price, volume, expected", [
    # --- EP: Valid Partition ---
    ("FPT", 95000, 10, {"status": "success"}),

    # --- EP: Invalid Partition ---
    ("", 95000, 10, {"status": "error", "msg": "MÃ£ cá»• phiáº¿u khÃ´ng há»£p lá»‡"}),
    ("FPT", -95000, 10, {"status": "error", "msg": "GiÃ¡ pháº£i > 0"}),
    ("FPT", 95000, 0, {"status": "error", "msg": "Khá»‘i lÆ°á»£ng pháº£i > 0"}),

    # --- BVA: Boundary Test ---
    ("FPT", 1, 1, {"status": "success"}),
    ("FPT", 1_000_000, 1_000_000, {"status": "success"}),
    ("FPT", 0, 100, {"status": "error", "msg": "GiÃ¡ pháº£i > 0"}),
    ("FPT", 50000, -1, {"status": "error", "msg": "Khá»‘i lÆ°á»£ng pháº£i > 0"}),
])
def test_place_sell_order(symbol, price, volume, expected):
    """Kiá»ƒm thá»­ cÃ¡c trÆ°á»ng há»£p Äáº¶T Lá»†NH BÃN"""
    result = place_sell_order(symbol, price, volume)
    assert result["status"] == expected["status"]
    if result["status"] == "error":
        assert result["msg"] == expected["msg"]
```

### 5.3 Quy trÃ¬nh kiá»ƒm thá»­ há»™p Ä‘en

1. XÃ¡c Ä‘á»‹nh **hÃ m cáº§n test** (vÃ­ dá»¥: `place_buy_order`, `place_sell_order`).  
2. XÃ¡c Ä‘á»‹nh **pháº¡m vi Ä‘áº§u vÃ o há»£p lá»‡ vÃ  khÃ´ng há»£p lá»‡**.  
3. Sinh cÃ¡c testcase theo **EP + BVA**.  
4. DÃ¹ng **pytest** Ä‘á»ƒ cháº¡y testcase.  
5. Kiá»ƒm tra **káº¿t quáº£ Ä‘áº§u ra** cÃ³ Ä‘Ãºng vá»›i mong Ä‘á»£i hay khÃ´ng.  


## 6. KIá»‚M THá»¬ Há»˜P TRáº®NG (WHITE-BOX TESTING)

Má»¥c tiÃªu: kiá»ƒm thá»­ dá»±a trÃªn **logic bÃªn trong code**, Ä‘áº£m báº£o **má»i nhÃ¡nh, cÃ¢u lá»‡nh vÃ  Ä‘Æ°á»ng Ä‘i** Ä‘á»u Ä‘Æ°á»£c thá»±c thi.

### 6.1 PhÆ°Æ¡ng phÃ¡p

- **Phá»§ lá»‡nh (Statement coverage):** má»i cÃ¢u lá»‡nh trong code pháº£i Ä‘Æ°á»£c thá»±c thi Ã­t nháº¥t má»™t láº§n.  
- **Phá»§ nhÃ¡nh (Branch coverage):** má»i nhÃ¡nh `if/else` Ä‘á»u pháº£i Ä‘Æ°á»£c kiá»ƒm thá»­.  
- **Phá»§ Ä‘Æ°á»ng (Path coverage):** má»i Ä‘Æ°á»ng Ä‘i tá»« Ä‘áº§u Ä‘áº¿n cuá»‘i hÃ m Ä‘á»u pháº£i Ä‘Æ°á»£c kiá»ƒm thá»­.

### 6.2 Quy trÃ¬nh kiá»ƒm thá»­ há»™p tráº¯ng

1. **Sinh CFG (Control Flow Graph):**  
```bash
python cfg_dot.py
```
   - Output: `order_mini.dot`  
   - Sá»­ dá»¥ng Graphviz Ä‘á»ƒ táº¡o áº£nh CFG: `CFG.png`

2. **TÃ¬m táº¥t cáº£ test path báº±ng DFS/BFS:**  
```bash
python dfs_from_dot.py
```
   - Output: `test_paths.txt`

3. **Lá»c test path theo Ä‘á»™ phá»§ (statement, branch, path):**  
```bash
python coverage_calc.py
```

4. **Cháº¡y testcase thá»±c táº¿ vÃ  Ä‘Ã¡nh giÃ¡ coverage:**  
```bash
python coverage_runtime.py
```

5. **Tá»± sinh input há»£p lá»‡ cho tá»«ng path báº±ng Z3:**  
```bash
python auto_testgen_z3.py
```
   - Output: `testcases_vn.csv` chá»©a cÃ¡c testcase há»£p lá»‡ theo tá»«ng path.

### 6.3 Lá»£i Ã­ch

- Äáº£m báº£o **táº¥t cáº£ cÃ¢u lá»‡nh vÃ  nhÃ¡nh trong code Ä‘Æ°á»£c kiá»ƒm thá»­**.  
- PhÃ¡t hiá»‡n **lá»—i logic tiá»m áº©n** mÃ  kiá»ƒm thá»­ há»™p Ä‘en cÃ³ thá»ƒ bá» sÃ³t.  
- Káº¿t há»£p vá»›i Z3 giÃºp **tá»± Ä‘á»™ng sinh input cho má»i path**, tÄƒng Ä‘á»™ bao phá»§ vÃ  giáº£m thao tÃ¡c thá»§ cÃ´ng.
